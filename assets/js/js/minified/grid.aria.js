!function(e){"use strict";"function"==typeof define&&define.amd?define(["jquery","./grid.base"],e):e(jQuery)}(function(v){"use strict";v.extend(v.jgrid,{focusableElementsList:[">a[href]",">button:not([disabled])",">area[href]",">input:not([disabled])",">select:not([disabled])",">textarea:not([disabled])",">iframe",">object",">embed",">*[tabindex]",">*[contenteditable]"]}),v.jgrid.extend({ariaBodyGrid:function(e){var f=v.extend({onEnterCell:null,onKeyCheck:null},e||{});return this.each(function(){var a=this,i=v.jgrid.getMethod("getStyleUI"),l=i(a.p.styleUI+".common","highlight",!0);function n(e,t){return!isNaN(e)&&!isNaN(t)&&0<=e&&0<=t&&a.rows.length&&e<a.rows.length&&t<a.p.colModel.length}function r(e,t){var t=a.p.iRow+t,i=a.p.iCol+e,r=a.rows.length,e=0!==e;if(!r)return!1;var o=a.p.colModel.length;return e&&(i<0&&2<=t&&(i=o-1,t--),o<=i&&(i=0,t++)),e||(t<1?(i--,a.rows[t=r-1]&&0<=i&&!a.rows[t].cells[i]&&t--):(r<=t||!a.rows[t].cells[i])&&(t=1,i++)),n(t,i)?{row:t,col:i}:!!n(a.p.iRow,a.p.iCol)&&{row:a.p.iRow,col:a.p.iCol}}function o(e,t){var i=r(e,t);if(!i)return!1;for(;v(a.rows[i.row].cells[i.col]).is(":hidden");)if(a.p.iRow=i.row,a.p.iCol=i.col,i=r(e,t),a.p.iRow===i.row&&a.p.iCol===i.col)return!1;return 0!==t&&v(a).jqGrid("setSelection",a.rows[i.row].id,!1,null,!1),i}function d(e){var t=a.p.page,i=a.p.lastpage;a.p.page!==(t=i<(t=(t+=e)<=0?1:t)?i:t)&&(a.p.page=t,a.grid.populate())}var t=v.jgrid.focusableElementsList.join();v(a).removeAttr("tabindex"),v(a).on("jqGridAfterGridComplete.setAriaGrid",function(e){v("tbody",a).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+t+"))").attr("tabindex",-1),v("tbody",a).first().find(">tr:not(.jqgfirstrow)").removeAttr("tabindex"),void 0!==a.p.iRow&&void 0!==a.p.iCol&&a.rows[a.p.iRow]&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",0).focus(function(){v(this).addClass(l)}).blur(function(){v(this).removeClass(l)})}),a.p.iRow=1,a.p.iCol=v.jgrid.getFirstVisibleCol(a);var s=0,c=0,p=!!v.jgrid.isFunction(f.customCellAction)&&f.customCellAction,u=!!v.jgrid.isFunction(f.onKeyCheck)&&f.onKeyCheck;v(a).on("keydown",function(e){if((!a.p.navigationDisabled||!0!==a.p.navigationDisabled)&&!e.target.id.startsWith("jqs_"+a.p.id)&&(!u||u.call(a,e.target))){var t;switch(e.which||e.keyCode){case 38:t=o(0,-1),s=t.row,c=t.col,e.preventDefault();break;case 40:t=o(0,1),s=t.row,c=t.col,e.preventDefault();break;case 37:t=o(-1,0),s=t.row,c=t.col,e.preventDefault();break;case 39:t=o(1,0),s=t.row,c=t.col,e.preventDefault();break;case 36:s=e.ctrlKey?1:a.p.iRow,c=0,e.preventDefault();break;case 35:s=e.ctrlKey?a.rows.length-1:a.p.iRow,c=a.p.colModel.length-1,e.preventDefault();break;case 33:d(-1),c=a.p.iCol,s=a.p.iRow,e.preventDefault();break;case 34:d(1),c=a.p.iCol,(s=a.p.iRow)>a.rows.length-1&&(s=a.rows.length-1,a.p.iRow=a.rows.length-1),e.preventDefault();break;case 13:return void(v.jgrid.isFunction(f.onEnterCell)&&(f.onEnterCell.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e),e.preventDefault()));case 113:try{v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e)}catch(e){}default:return void(p&&p.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))}v(a).jqGrid("focusBodyCell",s,c,i,l)}}),v(a).on("jqGridBeforeSelectRow.ariaGridClick",function(){return!1}),v(a).on("jqGridCellSelect.ariaGridClick",function(e,t,i,r,o){var n,o=o.target;0<a.p.iRow&&0<=a.p.iCol&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",-1),(v(o).is("td")||v(o).is("th")||o.id.startsWith("jqs_"+a.p.id))&&(a.p.iCol=o.cellIndex,n=v(o).closest("tr.jqgrow"),a.p.iRow=n[0].rowIndex,v(o).attr("tabindex",0).addClass(l).focus().blur(function(){v(this).removeClass(l)}))}),a.p.ariaBody=!0})},excelLikeGrid:function(e){var C=v.extend({beforeDeleteCell:null,customCellAction:null,customUndoFunction:null,specialChars:["~","!","@","#","$","%","^","&","*","(",")","_","+","{","}",":",'"',"|","<",">","?",",",".","/",";","\\","[","]"],addonChars:!1,onKeyCheck:null},e||{});return this.each(function(){var a=this,l=v.jgrid.getMethod("getStyleUI"),d=l(a.p.styleUI+".common","highlight",!0);function n(e,t){return!isNaN(e)&&!isNaN(t)&&0<=e&&0<=t&&a.rows.length&&e<a.rows.length&&t<a.p.colModel.length}function r(e,t){var t=a.p.iRow+t,i=a.p.iCol+e,r=a.rows.length,e=0!==e,o=a.p.frozenColumns?a.p.frozenColCount+1:0;if(!r)return!1;r=a.p.colModel.length;return e&&(i=i<o?o:i)===r&&(i=r),e||a.rows[t]&&0<=i&&!a.rows[t].cells[i]&&t--,n(t,i)?{row:t,col:i}:!!n(a.p.iRow,a.p.iCol)&&{row:a.p.iRow,col:a.p.iCol}}function s(e,t){var i=r(e,t);if(!i)return!1;for(;v(a.rows[i.row].cells[i.col]).is(":hidden");)if(a.p.iRow=i.row,a.p.iCol=i.col,i=r(e,t),a.p.iRow===i.row&&a.p.iCol===i.col)return!1;return 0!==t&&v(a).jqGrid("setSelection",a.rows[i.row].id,!1,null,!1),i}function c(e){var t=a.p.page,i=a.p.lastpage;a.p.page!==(t=i<(t=(t+=e)<=0?1:t)?i:t)&&(a.p.page=t,a.grid.populate())}a.p.F2key=!1;var t=v.jgrid.focusableElementsList.join();v(a).removeAttr("tabindex"),v(a).on("jqGridAfterGridComplete.setAriaGrid",function(e){v("tbody",a).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+t+"))").attr("tabindex",-1),v("tbody",a).first().find(">tr:not(.jqgfirstrow)").removeAttr("tabindex"),void 0!==a.p.iRow&&void 0!==a.p.iCol&&a.rows[a.p.iRow]&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",0).focus(function(){v(this).addClass(d)}).blur(function(){v(this).removeClass(d)})}),a.p.iRow=1,a.p.iCol=v.jgrid.getFirstVisibleCol(a),a.p.ariaBody=!0;var p=0,u=0,f=!!v.jgrid.isFunction(C.customCellAction)&&C.customCellAction,h=!!v.jgrid.isFunction(C.beforeDeleteCell)&&C.beforeDeleteCell,w=new Set(C.specialChars),g=!1,b=(a.addEventListener("paste",function(e){g&&(e=(e.clipboardData||window.clipboardData).getData("text"),v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,e),g=!1)}),!!v.jgrid.isFunction(C.onKeyCheck)&&C.onKeyCheck);v(a).on("keydown",function(e){if((!a.p.navigationDisabled||!0!==a.p.navigationDisabled)&&!e.target.id.startsWith("jqs_"+a.p.id)&&(!b||b.call(a,e.target))){var t=e.which||e.keyCode,i=e.ctrlKey||17===t;switch(t){case 38:r=s(0,-1),p=r.row,u=r.col,e.preventDefault();break;case 40:case 13:r=s(0,1),p=r.row,u=r.col,e.preventDefault();break;case 37:r=s(-1,0),p=r.row,u=r.col,e.preventDefault();break;case 39:r=s(1,0),p=r.row,u=r.col,e.preventDefault();break;case 36:p=e.ctrlKey?1:a.p.iRow,u=a.p.frozenColumns?a.p.frozenColCount+1:0,e.preventDefault();break;case 35:p=e.ctrlKey?a.rows.length-1:a.p.iRow,u=a.p.colModel.length-1,e.preventDefault();break;case 33:c(-1),u=a.p.iCol,p=a.p.iRow,e.preventDefault();break;case 34:c(1),u=a.p.iCol,(p=a.p.iRow)>a.rows.length-1&&(p=a.rows.length-1,a.p.iRow=a.rows.length-1),e.preventDefault();break;case 9:r=e.shiftKey?s(-1,0):s(1,0),p=r.row,u=r.col,e.preventDefault();break;case 113:try{v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e,!1),a.p.F2key=!0}catch(e){}break;case 8:case 46:var r=!0;!0===(r=h?h.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e):r)&&v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,"");break;case 86:if(i)return g=!0;case 90:if(i)return r=!0,(r=v.jgrid.isFunction(C.customUndoFunction)?C.customUndoFunction.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e):r)&&a.p.savedValues&&v(a).jqGrid("getCell",a.rows[a.p.iRow].id,a.p.colModel[a.p.iCol].name,!1)===a.p.savedValues.newvalue&&a.p.iRow===a.p.savedValues.indexRow&&v(a).jqGrid("saveCell",a.p.iRow,a.p.iCol,a.p.savedValues.oldvalue),!0;default:var r=/^[a-z]$/i.test(e.key),o=/^[0-9]$/i.test(e.key),n=!1;return C.addonChars&&(n=C.addonChars.test(e.key)),(r||o||w.has(e.key)||n)&&v(a).jqGrid("editCell",a.p.iRow,a.p.iCol,!0,e,!0),void(f&&f.call(a,a.rows[a.p.iRow].id,a.p.iRow,a.p.iCol,e))}v(a).jqGrid("focusBodyCell",p,u,l,d)}}),v(a).on("jqGridBeforeSelectRow.ariaGridClick",function(){return!1}),v(a).on("jqGridCellSelect.ariaGridClick",function(e,t,i,r,o){var n,o=o.target;0<a.p.iRow&&0<=a.p.iCol&&v(a.rows[a.p.iRow].cells[a.p.iCol]).attr("tabindex",-1),(v(o).is("td")||v(o).is("th")||o.id.startsWith("jqs_"+a.p.id))&&(a.p.iCol=o.cellIndex,a.p.savedRow.length&&v(a).jqGrid("saveCell",a.p.savedRow[0].id,a.p.savedRow[0].ic),n=v(o).closest("tr.jqgrow"),a.p.iRow=n[0].rowIndex,v(o).attr("tabindex",0).addClass(d).focus().blur(function(){v(this).removeClass(d)}))}).on("jqGridDblClickRow.ariaGridDblClick",function(e,t,i,r,o){v(a).jqGrid("editCell",i,r,!0,o,!1),a.p.F2key=!0})})},focusBodyCell:function(a,l,d,s){return this.each(function(){var e,t=this,i=d||v.jgrid.getMethod("getStyleUI"),r=s||i(t.p.styleUI+".common","highlight",!0),o=v.jgrid.focusableElementsList.join();function n(e){return v(o,e)[0]}void 0!==a&&void 0!==l?!isNaN(t.p.iRow)&&!isNaN(t.p.iCol)&&0<=t.p.iCol&&(e=n(t.rows[t.p.iRow].cells[t.p.iCol]),v(e||t.rows[t.p.iRow].cells[t.p.iCol]).attr("tabindex",-1)):(a=t.p.iRow,l=t.p.iCol),a=parseInt(a,10),l=parseInt(l,10),0<a&&0<=l&&(e=n(t.rows[a].cells[l]),v(e||t.rows[a].cells[l]).attr("tabindex",0).addClass(r).focus().blur(function(){v(this).removeClass(r)}),t.p.iRow=a,t.p.iCol=l)})},resetAriaBody:function(){return this.each(function(){var t=this,i=!1,e=(t.p.ariaBody=!1,v(t).attr("tabindex","0").off("keydown").off("jqGridBeforeSelectRow.ariaGridClick").off("jqGridCellSelect.ariaGridClick").off("jqGridAfterGridComplete.setAriaGrid"),v.jgrid.focusableElementsList.join());v("tbody",t).first().find(">tr:not(.jqgfirstrow)>td:not(:hidden, :has("+e+"))").removeAttr("tabindex").off("focus"),v("tbody",t).first().find(">tr:not(.jqgfirstrow)").attr("tabindex",-1);try{t.removeEventListener("paste",function(e){i&&(e=(e.clipboardData||window.clipboardData).getData("text"),v(t).jqGrid("saveCell",t.p.iRow,t.p.iCol,e),i=!1)},!0)}catch(e){}})},ariaHeaderGrid:function(){return this.each(function(){var o=this,e=v.jgrid.getMethod("getStyleUI")(o.p.styleUI+".common","highlight",!0),t=v("#gbox_"+o.p.id).find(".ui-jqgrid-hbox>table").first();v("tr.ui-jqgrid-labels",t).on("keydown",function(e){var t=o.p.selHeadInd,i=e.which||e.keyCode,r=o.grid.headers.length;switch(i){case 37:if(0<=t-1){for(t--;v(o.grid.headers[t].el).is(":hidden")&&0<=t-1&&!(--t<0););0<=t&&(v(o.grid.headers[t].el).focus(),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","-1"),o.p.selHeadInd=t,e.preventDefault())}break;case 39:if(t+1<r){for(t++;v(o.grid.headers[t].el).is(":hidden")&&t+1<r&&!(r-1<++t););t<r&&(v(o.grid.headers[t].el).focus(),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","-1"),o.p.selHeadInd=t,e.preventDefault())}break;case 13:v(o.grid.headers[t].el).find("div").first().trigger("click"),e.preventDefault();break;default:return}}),v("tr.ui-jqgrid-labels>th:not(:hidden)",t).attr("tabindex",-1).focus(function(){v(this).addClass(e).attr("tabindex","0")}).blur(function(){v(this).removeClass(e)}),o.p.selHeadInd=v.jgrid.getFirstVisibleCol(o),v(o.grid.headers[o.p.selHeadInd].el).attr("tabindex","0")})},focusHeaderCell:function(t){return this.each(function(){var e=this;0<=(t=void 0===t?e.p.selHeadInd:t)&&t<e.p.colModel.length&&(v(e.grid.headers[e.p.selHeadInd].el).attr("tabindex","-1"),v(e.grid.headers[t].el).focus(),e.p.selHeadInd=t)})},resetAriaHeader:function(){return this.each(function(){var e=v("#gbox_"+this.p.id).find(".ui-jqgrid-hbox>table").first();v("tr.ui-jqgrid-labels",e).off("keydown"),v("tr.ui-jqgrid-labels>th:not(:hidden)",e).removeAttr("tabindex").off("focus blur")})},ariaPagerGrid:function(){return this.each(function(){var r=this,e=v.jgrid.getMethod("getStyleUI"),t=e(r.p.styleUI+".common","highlight",!0),o="."+e(r.p.styleUI+".common","disabled",!0),n=v(".ui-pg-button",r.p.pager),a=n.length;n.attr("tabindex","-1").focus(function(){v(this).addClass(t)}).blur(function(){v(this).removeClass(t)}),r.p.navIndex=0,setTimeout(function(){var e=n.not(o).first().attr("tabindex","0");r.p.navIndex=e[0]&&e[0].cellIndex?e[0].cellIndex-1:0},100),v(r.p.pager).find("table.ui-pager-table tr").first().on("keydown",function(e){var t=e.which||e.keyCode,i=r.p.navIndex;switch(t){case 37:if(0<=i-1){for(i--;v(n[i]).is(o)&&0<=i-1&&!(--i<0););0<=i&&(v(n[r.p.navIndex]).attr("tabindex","-1"),v(n[i]).attr("tabindex","0").focus(),r.p.navIndex=i),e.preventDefault()}break;case 39:if(i+1<a){for(i++;v(n[i]).is(o)&&i+1<a+1&&!(a-1<++i););i<a&&(v(n[r.p.navIndex]).attr("tabindex","-1"),v(n[i]).attr("tabindex","0").focus(),r.p.navIndex=i),e.preventDefault()}break;case 13:v(n[i]).trigger("click"),e.preventDefault();break;default:return}})})},focusPagerCell:function(i){return this.each(function(){var e=v(".ui-pg-button",this.p.pager),t=e.length;0<=(i=void 0===i?this.p.navIndex:i)&&i<t&&(v(e[this.p.navIndex]).attr("tabindex","-1"),v(e[i]).attr("tabindex","0").focus(),this.p.navIndex=i)})},resetAriaPager:function(){return this.each(function(){v(".ui-pg-button",this.p.pager).removeAttr("tabindex").off("focus"),v(this.p.pager).find("table.ui-pager-table tr").first().off("keydown")})},setAriaGrid:function(e){var t=v.extend({header:!0,body:!0,pager:!0,onEnterCell:null,customCellAction:null,excel:!1},e||{});return this.each(function(){t.header&&v(this).jqGrid("ariaHeaderGrid"),t.body&&(t.excel?v(this).jqGrid("excelLikeGrid",t):v(this).jqGrid("ariaBodyGrid",t)),t.pager&&v(this).jqGrid("ariaPagerGrid")})},resetAriaGrid:function(e){var t=v.extend({header:!0,body:!0,pager:!0},e||{});return this.each(function(){t.body&&v(this).jqGrid("resetAriaBody"),t.header&&v(this).jqGrid("resetAriaHeader"),t.pager&&v(this).jqGrid("resetAriaPager")})}})});